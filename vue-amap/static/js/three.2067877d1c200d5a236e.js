!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("VueAMap",[],e):"object"==typeof exports?exports.VueAMap=e():t.VueAMap=e()}(window,function(){var p={1:function(t,e,n){"use strict";var o=n(4),i=n.n(o),r=n(6),s=n(5);e.a={inject:{parentInstance:{default:null}},props:{visible:{type:Boolean,default:!0},zIndex:{type:Number},extraOptions:{type:Object}},data:function(){return{unwatchFns:[],handlers:{visible:function(t){this.show&&this.hide&&(!1===t?this.hide():this.show())},zIndex:function(t){this.setzIndex&&this.setzIndex(t)}},needInitComponents:[],isDestroy:!1}},mounted:function(){this.parentInstance&&(this.parentInstance.$amapComponent?this.register():this.parentInstance.addChildComponent(this))},beforeDestroy:function(){this.$amapComponent&&(this.unregisterEvents(),this.unwatchFns.forEach(function(t){return t()}),this.unwatchFns=[],this.destroyComponent(),this.$amapComponent=null,this.$parentComponent=null,this.isDestroy=!0)},methods:{addChildComponent:function(t){this.needInitComponents.push(t)},createChildren:function(){for(;0<this.needInitComponents.length;)this.needInitComponents[0].register(),this.needInitComponents.splice(0,1)},getHandlerFun:function(t){return this.handlers&&this.handlers[t]?this.handlers[t]:this.$amapComponent["set"+i()(t)]},convertProps:function(){var i=this,r={},t=this.$options.propsData,s=void 0===t?{}:t,a=this.propsRedirect;return this.extraOptions&&Object.assign(r,this.extraOptions),Object.keys(s).reduce(function(t,e){var n=e,o=i.convertSignalProp(n,s[n]);return void 0!==o&&(a&&a[e]&&(n=a[n]),r[n]=o),t},r)},convertSignalProp:function(t,e){return this.converters&&this.converters[t]?this.converters[t].call(this,e):(t=r.a[t])?t(e):e},registerEvents:function(){var e=this,n=this.$listeners;Object.keys(n).forEach(function(t){s.a.addListener(e.$amapComponent,t,n[t])})},unregisterEvents:function(){var e=this,n=this.$listeners;Object.keys(n).forEach(function(t){s.a.removeListener(e.$amapComponent,t,n[t])})},setPropWatchers:function(){var o=this,i=this.propsRedirect,t=this.$options.propsData,r=void 0===t?{}:t;Object.keys(r).forEach(function(e){var t=e,n=(i&&i[e]&&(t=i[e]),o.getHandlerFun(t));n&&(t={deep:!1},"[object Object]"===Object.prototype.toString.call(r[e])&&(t.deep=!0),t=o.$watch(e,function(t){n.call(o.$amapComponent,o.convertSignalProp(e,t))},t),o.unwatchFns.push(t))})},initProps:function(){var n=this;["editable","visible","zooms"].forEach(function(t){var e;void 0!==n[t]&&(e=n.getHandlerFun(t))&&e.call(n.$amapComponent,n.convertSignalProp(t,n[t]))})},printReactiveProp:function(){var e=this;Object.keys(this._props).forEach(function(t){e.$amapComponent["set"+i()(t)]&&console.log(t)})},register:function(){var e=this,t=(this.parentInstance&&!this.$parentComponent&&(this.$parentComponent=this.parentInstance.$amapComponent),this.__initComponent&&this.__initComponent(this.convertProps()));t&&t.then?t.then(function(t){return e.registerRest(t)}):this.registerRest(t)},registerRest:function(t){var e=this;!this.$amapComponent&&t&&(this.$amapComponent=t),this.$amapComponent&&(this.registerEvents(),this.initProps(),this.setPropWatchers(),this.$nextTick(function(){e.createChildren()})),this.$listeners.init&&this.$emit("init",this.$amapComponent,this)},$$getInstance:function(){return this.$amapComponent},destroyComponent:function(){this.$amapComponent.setMap&&this.$amapComponent.setMap(null),this.$amapComponent.close&&this.$amapComponent.close(),this.$amapComponent.editor&&this.$amapComponent.editor.close()}}}},25:function(t,e,n){"use strict";n.r(e);var o=n(4),i=n.n(o),o=n(1),c=n(0),s=n(26),a=n(18);function r(t){(function e(t){t=t.children.filter(function(t){return t});t.forEach(function(t){t.children.length?e(t):t.isMesh&&((t=t).geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),t.material.texture)&&t.material.texture.dispose()})})(t)}function p(t){p.installed||g.install(t)}var h={AmbientLight:c.a,DirectionalLight:c.p,HemisphereLight:c.w,PointLight:c.db,RectAreaLight:c.kb,SpotLight:c.qb},u=new c.jb,l=new c.xb,m={name:"el-amap-layer-three",mixins:[o.a],provide:function(){return{parentInstance:this}},props:{lights:{type:Array,default:function(){return[]}},hdr:{type:Object},zooms:{type:Array,default:function(){return[2,20]}},opacity:{type:Number},alpha:{type:Boolean,default:!1},antialias:{type:Boolean,default:!1}},data:function(){return{}},methods:{__initComponent:function(r){var t=this,a=this,p=(this.customCoords=this.$parentComponent.customCoords,this.$parentComponent.getCenter());return this.center=p,this.customCoords.lngLatsToCoords([p.toArray()]),new Promise(function(i){r.init=function(t){var e=a.$parentComponent.getContainer(),n=null,o=e.offsetWidth,e=e.offsetHeight,n="3D"===a.$parentComponent.getView().type?new c.cb(60,o/e,100,1<<30):new c.ab(o/-2,o/2,e/2,e/-2,1,1e3),o=new c.Ab({context:t,alpha:r.alpha,antialias:r.antialias}),e=(o.autoClear=!1,new c.mb);a.camera=n,a.renderer=o,a.scene=e,a._createLights(),a._createHDR(),a._animate(),a._bindEvents(),i()},r.render=function(){a.renderer.resetState(),a.customCoords.setCenter(p.toArray());var t,e,n,o,i,r,s=a.camera;"3D"===a.$parentComponent.getView().type?(e=(n=a.customCoords.getCameraParams()).near,o=n.far,t=n.fov,i=n.up,r=n.lookAt,n=n.position,s.near=e,s.far=o,s.fov=t,(e=s.position).set.apply(e,n),(o=s.up).set.apply(o,i),s.lookAt.apply(s,r)):(e=(t=a.customCoords.getCameraParams()).top,n=t.bottom,o=t.left,i=t.right,r=t.position,s.top=e,s.bottom=n,s.left=o,s.right=i,(t=s.position).set.apply(t,r)),s.updateProjectionMatrix(),a.renderer.render(a.scene,s),a.renderer.resetState()},t.$amapComponent=new AMap.GLCustomLayer(r),t.$amapComponent.setMap(t.$parentComponent)})},destroyComponent:function(){this._unBindEvents(),this.customCoords=null,this.$parentComponent=null,cancelAnimationFrame(this.frameTimer),this.$amapComponent.setMap(null),this.$amapComponent.envMap&&(this.$amapComponent.envMap.dispose(),this.$amapComponent.envMap=null),this.customCoords=null,this.scene.traverse(function(t){r(t)}),this.scene=null,this.camera=null,this.renderer.dispose(),this.renderer=null,this.$amapComponent=null,this.$parentComponent=null,c.h.clear()},convertLngLat:function(t){return this.customCoords.setCenter(this.center),this.customCoords.lngLatsToCoords([t])[0]},addObject:function(t){this.scene.add(t),this._refreshMap()},removeObject:function(t){this.scene.remove(t)},_animate:function(){var t=this;this.$amapComponent.needsUpdate&&(this._refreshMap(),this.$amapComponent.needsUpdate=!1),this.frameTimer=requestAnimationFrame(function(){t._animate()})},_createLights:function(){var o=this,t=this.lights,i={type:"DirectionalLight",args:[]};0<t.length&&t.forEach(function(t){var e,n;t=Object(s.a)({},i,t),h[t.type]?(e=new(Function.prototype.bind.apply(h[t.type],[null].concat(t.args))),n=t.position,t=t.lookAt,n&&e.position.set(n.x,n.y,n.z),t&&e.lookAt(t.x,t.y,t.z),o.scene.add(e),o._refreshMap()):console.warn("当前设置的灯光类型不存在")})},_createHDR:function(){var t,e,n,o,i,r=this;this.hdr&&(t=Object(s.a)({},{urls:"",path:"/",exposure:1},this.hdr),(e=this.renderer).physicallyCorrectLights=!0,e.outputEncoding=c.Bb,e.toneMappingExposure=t.exposure,(n=t.urls)instanceof Array||(n=[n]),(o=new c.bb(e)).compileCubemapShader(),i=(new a.a).setDataType(c.wb).setPath(t.path).load(n,function(){var t=o.fromCubemap(i);i.magFilter=c.I,i.needsUpdate=!0,r.$amapComponent.envMap=t?t.texture:null,r.addEnvMap(r.scene),r._refreshMap()}))},addEnvMap:function(t){var e=this,n=this.$amapComponent.envMap;n&&t&&(t.material&&n&&(t.material.envMap=n,t.material.needsUpdate=!0),t.children)&&0<t.children.length&&t.children.forEach(function(t){e.addEnvMap(t)})},_refreshMap:function(){this.$parentComponent&&this.$parentComponent.render()},_bindEvents:function(){this.$parentComponent.on("click",this._clickEvent),this.$parentComponent.on("mousemove",this._hoverEvent)},_unBindEvents:function(){this.$parentComponent.off("click",this._clickEvent),this.$parentComponent.off("mousemove",this._hoverEvent)},_clickEvent:function(t){t=this._intersectGltf(t);t&&t.$vue.$emit("click",t)},_hoverEvent:function(t){t=this._intersectGltf(t);t?t.isHover||(t.isHover=!0,t.$vue.$emit("mouseover",t)):this.scene.children.forEach(function(t){t.isCustomGroup&&!0===t.isHover&&(t.isHover=!1,t.$vue.$emit("mouseout",t))})},_intersectGltf:function(t){var e=this.$parentComponent.getContainer(),n=e.getBoundingClientRect(),o=n.top+window.pageYOffset-e.clientTop,e=n.left+window.pageXOffset-e.clientLeft,e=(l.x=(t.originEvent.x+window.pageXOffset-e)/n.width*2-1,l.y=2*-((t.originEvent.y+window.pageYOffset-o)/n.height)+1,this.camera),i=(u.setFromCamera(l,e),u.intersectObjects([this.scene],!0)),r=i.length;if(0<r){for(var s=null,a=0;a<r;a++){var p=i[a];if(null!==(s=this._getGroup(p.object)))break}return s}return null},_getGroup:function(t){return t.isCustomGroup?t:this._getGroup(t.parent)},$$getScene:function(){return this.scene},$$getRender:function(){return this.renderer},$$refresh:function(){this.$parentComponent&&this.$parentComponent.render()}}},f=n(2),m=Object(f.a)(m,function(){return(0,this._self._c)("div",[this._t("default")],2)},[],!1,null,null,null).exports,d=n(15),n={name:"el-amap-three-gltf",mixins:[o.a],inject:{parentInstance:{default:null}},props:{url:{type:String},position:{type:Array},rotation:{type:Object},scale:{type:Number,default:1},angle:{type:Number},height:{type:Number}},data:function(){var t=this;return{handlers:{position:function(){t.setPosition()},visible:function(){t.setVisible()},rotation:function(){t.setRotation()},angle:function(){t.setAngle()},height:function(){t.setHeight()}}}},methods:{__initComponent:function(t){var r=this;return new Promise(function(o){var i=r.parentInstance.convertLngLat(t.position);(new d.a).load(t.url,function(t){var e=t.scene,t=(e.isCustomGroup=!0,e.$vue=r,t.animations),n=r.scale;e.position.set(i[0],i[1],0),r.parentInstance.addEnvMap(e),r.parentInstance.addObject(e),r.$amapComponent=e,r.animations=t,e.scale.set(n,n,n),r.setRotation(),r.setAngle(),r.setHeight(),r.setVisible(),r._refresh(),o()})})},destroyComponent:function(){this.linerAnimationFrame&&cancelAnimationFrame(this.linerAnimationFrame),this.parentInstance.removeObject(this.$amapComponent),this.$amapComponent&&(this.$amapComponent.$vue=null,r(this.$amapComponent),this.$amapComponent=null,this.$parentComponent=null)},setPosition:function(){var t=this.$parent.convertLngLat(this.position);this.$amapComponent.position.setX(t[0]),this.$amapComponent.position.setY(t[1]),this._refresh()},setRotation:function(){var t,e,n;this.rotation&&(t=Math.PI/180*(this.rotation.x||0),e=Math.PI/180*(this.rotation.y||0),n=Math.PI/180*(this.rotation.z||0),this.$amapComponent.rotation.set(t,e,n),this._refresh())},setAngle:function(){var t,e,n;void 0!==this.angle&&(t=this.$amapComponent.rotation.x,e=this.$amapComponent.rotation.z,n=Math.PI/180*this.angle,this.$amapComponent.rotation.set(t,n,e),this._refresh())},setHeight:function(){void 0!==this.height&&(this.$amapComponent.position.setZ(this.height),this._refresh())},setVisible:function(){!1===this.visible?this.$amapComponent.visible=!1:this.$amapComponent.visible=!0,this._refresh()},_refresh:function(){this.$parentComponent.needsUpdate=!0},_animate:function(t){var e=this;this.linerAnimationFrame=requestAnimationFrame(function(){e._animate(t)}),t()},$$startAnimations:function(){var e=this;if(this.animations){for(var t=this.animations,n=new c.c(this.$amapComponent),o={},i=0;i<t.length;i++){var r=t[i];o[r.name]=n.clipAction(r)}var s,a=new c.j;for(s in o)o[s].play();this._animate(function(){var t=a.getDelta();n&&n.update(t),e._refresh()})}},$$stopAnimations:function(){cancelAnimationFrame(this.linerAnimationFrame)}}},v=[m,Object(f.a)(n,function(){return(0,this._self._c)("div")},[],!1,null,null,null).exports],g=window.VueAMap||{};g.install=function(e){g.installed||(e.config.optionMergeStrategies.deferredReady=e.config.optionMergeStrategies.created,v.map(function(t){e.component(t.name,t),g[i()(t.name).replace(/^El/,"")]=t}))},"undefined"!=typeof window&&window.Vue&&p(window.Vue),e.default=g},5:function(t,e,n){"use strict";var o;function i(){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this._listener=new Map}i.prototype.addListener=function(t,e,n,o){if(!AMap)throw new Error("please wait for Map API load");t.on&&(t.on(e,n,o),this._listener.get(t)||this._listener.set(t,{}),(o=this._listener.get(t))[e]||(o[e]=[]),o[e].push(n))},i.prototype.removeListener=function(e,t,n){if(!AMap)throw new Error("please wait for Map API load");var o;e.off&&this._listener.get(e)&&this._listener.get(e)[t]&&(o=this._listener.get(e)[t],n?(n=o.indexOf(n),e.off(o[n]),o.splice(n,1)):(o.forEach(function(t){e.off(t)}),this._listener.get(e)[t]=[]))},i.prototype.addListenerOnce=function(t,e,n,o){return t.on(e,n,o,!0)},i.prototype.trigger=function(t,e,n){return t.emit(e,n)},i.prototype.clearListeners=function(e){var t=this._listener.get(e);t&&Object.keys(t).map(function(t){e.clearEvents(t)})},o=new i,e.a=o},6:function(t,e,n){"use strict";function o(t){return new AMap.LngLat(t[0],t[1])}n.d(e,"b",function(){return o}),n.d(e,"a",function(){return i});var i={}}};function t(t){for(var e,n,o=t[0],i=t[1],r=t[2],s=0,a=[];s<o.length;s++)n=o[s],Object.prototype.hasOwnProperty.call(h,n)&&h[n]&&a.push(h[n][0]),h[n]=0;for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(p[e]=i[e]);for(l&&l(t);a.length;)a.shift()();return u.push.apply(u,r||[]),c()}function c(){for(var t,e=0;e<u.length;e++){for(var n=u[e],o=!0,i=1;i<n.length;i++){var r=n[i];0!==h[r]&&(o=!1)}o&&(u.splice(e--,1),t=s(s.s=n[0]))}return t}var n={},h={2:0},u=[];function s(t){var e;return(n[t]||(e=n[t]={i:t,l:!1,exports:{}},p[t].call(e.exports,e,e.exports,s),e.l=!0,e)).exports}s.m=p,s.c=n,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="./";var e=(o=window.webpackJsonpVueAMap=window.webpackJsonpVueAMap||[]).push.bind(o);o.push=t;for(var o=o.slice(),i=0;i<o.length;i++)t(o[i]);var l=e;return u.push([25,0]),c()});